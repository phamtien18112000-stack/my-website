{"ast":null,"code":"import { bcs } from \"@mysten/sui/bcs\";\nimport { SuiGraphQLClient } from \"@mysten/sui/graphql\";\nimport { graphql } from \"@mysten/sui/graphql/schemas/latest\";\nimport { fromBase64, normalizeSuiAddress } from \"@mysten/sui/utils\";\nimport { ZkSendLink } from \"./claim.js\";\nimport { getContractIds } from \"./zk-bag.js\";\nconst ListCreatedLinksQuery = graphql(`\n\tquery listCreatedLinks($address: SuiAddress!, $function: String!, $cursor: String) {\n\t\ttransactionBlocks(\n\t\t\tlast: 10\n\t\t\tbefore: $cursor\n\t\t\tfilter: { sentAddress: $address, function: $function }\n\t\t) {\n\t\t\tpageInfo {\n\t\t\t\tstartCursor\n\t\t\t\thasPreviousPage\n\t\t\t}\n\t\t\tnodes {\n\t\t\t\teffects {\n\t\t\t\t\ttimestamp\n\t\t\t\t}\n\t\t\t\tdigest\n\t\t\t\tbcs\n\t\t\t}\n\t\t}\n\t}\n`);\nasync function listCreatedLinks({\n  address,\n  cursor,\n  network,\n  contract = getContractIds(network),\n  fetch: fetchFn,\n  ...linkOptions\n}) {\n  const gqlClient = new SuiGraphQLClient({\n    url: network === \"testnet\" ? \"https://sui-testnet.mystenlabs.com/graphql\" : \"https://sui-mainnet.mystenlabs.com/graphql\",\n    fetch: fetchFn\n  });\n  const packageId = normalizeSuiAddress(contract.packageId);\n  const page = await gqlClient.query({\n    query: ListCreatedLinksQuery,\n    variables: {\n      address,\n      cursor,\n      function: `${packageId}::zk_bag::new`\n    }\n  });\n  const transactionBlocks = page.data?.transactionBlocks;\n  if (!transactionBlocks || page.errors?.length) {\n    throw new Error(\"Failed to load created links\");\n  }\n  const links = (await Promise.all(transactionBlocks.nodes.map(async node => {\n    if (!node.bcs) {\n      return null;\n    }\n    const kind = bcs.TransactionData.parse(fromBase64(node.bcs)).V1.kind;\n    if (!kind?.ProgrammableTransaction) {\n      return null;\n    }\n    const {\n      inputs,\n      commands\n    } = kind.ProgrammableTransaction;\n    const fn = commands.find(command => command.MoveCall?.package === packageId && command.MoveCall.module === \"zk_bag\" && command.MoveCall.function === \"new\");\n    if (!fn?.MoveCall) {\n      return null;\n    }\n    const addressArg = fn.MoveCall.arguments[1];\n    if (addressArg.$kind !== \"Input\") {\n      throw new Error(\"Invalid address argument\");\n    }\n    const input = inputs[addressArg.Input];\n    if (!input.Pure) {\n      throw new Error(\"Expected Address input to be a Pure value\");\n    }\n    const address2 = bcs.Address.fromBase64(input.Pure.bytes);\n    const link = new ZkSendLink({\n      network,\n      address: address2,\n      contract,\n      isContractLink: true,\n      ...linkOptions\n    });\n    await link.loadAssets();\n    return {\n      link,\n      claimed: !!link.claimed,\n      assets: link.assets,\n      digest: node.digest,\n      createdAt: node.effects?.timestamp\n    };\n  }))).reverse();\n  return {\n    cursor: transactionBlocks.pageInfo.startCursor,\n    hasNextPage: transactionBlocks.pageInfo.hasPreviousPage,\n    links: links.filter(link => link !== null)\n  };\n}\nexport { listCreatedLinks };\n//# sourceMappingURL=list-created-links.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}