{"ast":null,"code":"var __typeError = msg => {\n  throw TypeError(msg);\n};\nvar __accessCheck = (obj, member, msg) => member.has(obj) || __typeError(\"Cannot \" + msg);\nvar __privateGet = (obj, member, getter) => (__accessCheck(obj, member, \"read from private field\"), getter ? getter.call(obj) : member.get(obj));\nvar __privateAdd = (obj, member, value) => member.has(obj) ? __typeError(\"Cannot add the same private member more than once\") : member instanceof WeakSet ? member.add(obj) : member.set(obj, value);\nvar _queue, _queue2;\nclass SerialQueue {\n  constructor() {\n    __privateAdd(this, _queue, []);\n  }\n  async runTask(task) {\n    return new Promise((resolve, reject) => {\n      __privateGet(this, _queue).push(() => {\n        task().finally(() => {\n          __privateGet(this, _queue).shift();\n          if (__privateGet(this, _queue).length > 0) {\n            __privateGet(this, _queue)[0]();\n          }\n        }).then(resolve, reject);\n      });\n      if (__privateGet(this, _queue).length === 1) {\n        __privateGet(this, _queue)[0]();\n      }\n    });\n  }\n}\n_queue = new WeakMap();\nclass ParallelQueue {\n  constructor(maxTasks) {\n    __privateAdd(this, _queue2, []);\n    this.activeTasks = 0;\n    this.maxTasks = maxTasks;\n  }\n  runTask(task) {\n    return new Promise((resolve, reject) => {\n      if (this.activeTasks < this.maxTasks) {\n        this.activeTasks++;\n        task().finally(() => {\n          if (__privateGet(this, _queue2).length > 0) {\n            __privateGet(this, _queue2).shift()();\n          } else {\n            this.activeTasks--;\n          }\n        }).then(resolve, reject);\n      } else {\n        __privateGet(this, _queue2).push(() => {\n          task().finally(() => {\n            if (__privateGet(this, _queue2).length > 0) {\n              __privateGet(this, _queue2).shift()();\n            } else {\n              this.activeTasks--;\n            }\n          }).then(resolve, reject);\n        });\n      }\n    });\n  }\n}\n_queue2 = new WeakMap();\nexport { ParallelQueue, SerialQueue };\n//# sourceMappingURL=queue.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}