{"ast":null,"code":"import { findTransactionBlockNames, listToRequests, replaceNames } from \"./utils.js\";\nconst namedPackagesPlugin = ({\n  suiGraphQLClient,\n  pageSize = 10,\n  overrides = {\n    packages: {},\n    types: {}\n  }\n}) => {\n  const cache = {\n    packages: {\n      ...overrides.packages\n    },\n    types: {\n      ...overrides.types\n    }\n  };\n  return async (transactionData, _buildOptions, next) => {\n    const names = findTransactionBlockNames(transactionData);\n    const batches = listToRequests({\n      packages: names.packages.filter(x => !cache.packages[x]),\n      types: names.types.filter(x => !cache.types[x])\n    }, pageSize);\n    (await Promise.all(batches.map(batch => query(suiGraphQLClient, batch)))).forEach(res => {\n      Object.assign(cache.types, res.types);\n      Object.assign(cache.packages, res.packages);\n    });\n    replaceNames(transactionData, cache);\n    await next();\n  };\n  async function query(client, requests) {\n    const results = {\n      packages: {},\n      types: {}\n    };\n    if (requests.length === 0) return results;\n    const gqlQuery = `{\n        ${requests.map(req => {\n      const request = req.type === \"package\" ? \"packageByName\" : \"typeByName\";\n      const fields = req.type === \"package\" ? \"address\" : \"repr\";\n      return `${gqlQueryKey(req.id)}: ${request}(name:\"${req.name}\") {\n                    ${fields}\n                }`;\n    })}\n    }`;\n    const result = await client.query({\n      query: gqlQuery,\n      variables: void 0\n    });\n    if (result.errors) throw new Error(JSON.stringify({\n      query: gqlQuery,\n      errors: result.errors\n    }));\n    for (const req of requests) {\n      const key = gqlQueryKey(req.id);\n      if (!result.data || !result.data[key]) throw new Error(`No result found for: ${req.name}`);\n      const data = result.data[key];\n      if (req.type === \"package\") results.packages[req.name] = data.address;\n      if (req.type === \"moveType\") results.types[req.name] = data.repr;\n    }\n    return results;\n  }\n};\nconst gqlQueryKey = idx => `key_${idx}`;\nexport { namedPackagesPlugin };\n//# sourceMappingURL=NamedPackagesPlugin.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}